(()=>{"use strict";function l(t){if(console.log(`arr ${t}`),0==t.length)return[];if(1==t.length)return t;{let e=Math.floor(t.length/2),o=l(t.slice(e)),n=l(t.splice(0,t.length-o.length));console.log(`divide ${e}`),console.log(`right ${o}`),console.log(`left ${n}`);let r=[],a=0,i=0;for(let l=0;l<n.length+o.length;l++){if(console.log("in the for loop"),n[a]<o[i]?(console.log(`${n[a]} < ${o[i]}`),r[l]=n[a],a++):(r[l]=o[i],console.log(`${o[i]} < ${n[a]}`),i++),i==o.length)return console.log("end of right"),r=r.concat(n.slice(a)),console.log(r),r;if(a==n.length){console.log("end of left");let l=o.slice(i);return console.log(`${l} is left and is array? ${Array.isArray(l)}`),r=r.concat(l),console.log(r),r}}return console.log(r),r}}function t(l,t=null,e=null){return{data:l,left:t,right:e}}const e=(l,t="",o=!0)=>{null!==l&&(null!==l.right&&e(l.right,`${t}${o?"│   ":"    "}`,!1),console.log(`${t}${o?"└── ":"┌── "}${l.data}`),null!==l.left&&e(l.left,`${t}${o?"    ":"│   "}`,!0))};let o=function(){const o=(l,e=0,n=l.length-1)=>{if(e>n)return console.log("null!!!"),null;let r=parseInt((n+e)/2);console.log(`start ${e} value ${l[e]}`),console.log(`end ${n} value ${l[n]}`),console.log(`mid ${r} value ${l[r]}`);let a=t(l[r]);return a.left=o(l,e,r-1),a.right=o(l,r+1,n),console.log(`new node data is ${a.data}`),a};let n=(l=>{for(let t=0;t<l.length;t++)l[t]==l[t+1]&&l.splice(t,1);return l})(l([1,7,4,23,8,9,4,3,5,7,9,67,6345,324])),r=o(n),a=[];const i=(l,e=r)=>null==e?(e=t(l),console.log(`inserting ${l}... checkNode.data is ${e.data} and left is ${e.left}`),e):(l<e.data?e.left=i(l,e.left):l>e.data?e.right=i(l,e.right):l==e.data&&console.log("sorry can't insert, it already exists"),e),g=l=>null==l.left?(console.log(`leftmost leaf is ${l.data}`),l):g(l.left),s=(l,t=r)=>{if(null==t);else{if(t.data==l)return t;if(l<t.data)return s(l,t.left);if(l>t.data)return s(l,t.right)}},h=l=>{let t=[];return console.log(l.data),null==l.left&&null==l.right?(t=t.concat(l.data),t):(null!=l.left&&(t=t.concat(h(l.left))),t=t.concat(l.data),null!=l.right&&(t=t.concat(h(l.right))),console.log(t),t)},f=(l,t=r,o=r,n="")=>{if(console.log(`DeleteItem (${l},${t.data},${o.data},${n})`),t.data==l){if(null==t.left&&null==t.right)return console.log("its a leaf! lets delete it"),console.log(`direction is ${n}`),console.log(`prevNode is ${o.data}`),"right"==n?o.right=null:o.left=null,r;if(null!=t.left&&null==t.right)console.log("only has left subtree"),"right"==n?o.right=t.left:o.left=t.left;else if(null==t.left&&null!=t.right)console.log("only has right subtree"),"right"==n?(o.right=t.right,console.log(`${o.data}.right = ${t.data}.right`)):o.left=t.right;else if(null!=t.left&&null!=t.right){console.log("it has two subtrees!");let o=g(t.right);t.data=o.data,o.data=l,e(r),f(l,t.right,t,"right")}return r}l<t.data?f(l,t.left,t,"left"):l>t.data&&f(l,t.right,t,"right")},u=(l,t=[r])=>{if(null==l)throw new Error("you need a callback function");if(0!=t.length&&t!=[]){let e=t[0];l(e),null!=e.left&&t.push(e.left),null!=e.right&&t.push(e.right),t.shift(),u(l,t)}},c=(l,t=[r])=>{if(0!=t.length){let e=t[0];return l(e),t.shift(),null!=e.left&&(t.push(e.left),c(l,t)),void(null!=e.right&&(t.push(e.right),c(l,t)))}},d=(l,t=[r])=>{let e=t[t.length-1];if(null==e.left&&null==e.right)return l(e),void t.pop();null!=e.left&&(t.push(e.left),d(l,t)),l(e),t.pop(),null!=e.right&&(t.push(e.right),d(l,t))},$=(l,t=[r])=>{let e=t[t.length-1];null==e.left&&null==e.right?(l(e),t.pop()):(null!=e.left&&(t.push(e.left),$(l,t)),null!=e.right&&(t.push(e.right),$(l,t)),l(e),t.pop())},p=(l,t=0,e=0)=>(console.log(`count is ${t} maxcount is ${e} node is ${l.data}`),null==l.left&null==l.right?(t>e&&(e=t),t=0,e):(null!=l.left&&(t++,e=p(l.left,t,e),t=0),null!=l.right&&(t++,e=p(l.right,t,e),t=0),e)),b=(l,t=r,e=0)=>t==l?e:l.data>t.data?(e++,b(l,t.right,e)):l.data<t.data?(e++,b(l,t.left,e)):void 0,v=l=>{a.push(l.data)};return{root:r,insert:i,findLeftLeaf:g,find:s,treeToArray:h,deleteItem:f,levelOrder:u,preOrder:c,inOrder:d,postOrder:$,height:p,depth:b,isBalanced:()=>(console.log(`root.data ${r.data}`),!(Math.abs(p(r.right)-p(r.left))>1)),rebalance:()=>{a=[],d(v),console.log(a);let l=o(a);r.data=l.data,r.left=l.left,r.right=l.right}}}();o.insert(54),o.insert(55),o.insert(56),o.insert(57),o.insert(58),e(o.root),o.deleteItem(4),e(o.root),console.log(`is balanced ${o.isBalanced()}`),o.rebalance(),e(o.root),console.log(`is balanced ${o.isBalanced()}`)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBWUEsU0FBU0EsRUFBVUMsR0FHakIsR0FGQUMsUUFBUUMsSUFBSSxPQUFPRixLQUVELEdBQWRBLEVBQUlHLE9BQ04sTUFBTyxHQUNGLEdBQWtCLEdBQWRILEVBQUlHLE9BQ2IsT0FBT0gsRUFDRixDQUNMLElBQUlJLEVBQVNDLEtBQUtDLE1BQU1OLEVBQUlHLE9BQVMsR0FDakNJLEVBQVFSLEVBQVVDLEVBQUlRLE1BQU1KLElBQzVCSyxFQUFPVixFQUFVQyxFQUFJVSxPQUFPLEVBQUdWLEVBQUlHLE9BQVNJLEVBQU1KLFNBRXRERixRQUFRQyxJQUFJLFVBQVVFLEtBQ3RCSCxRQUFRQyxJQUFJLFNBQVNLLEtBQ3JCTixRQUFRQyxJQUFJLFFBQVFPLEtBRXBCLElBQUlFLEVBQVMsR0FDVEMsRUFBSSxFQUNKQyxFQUFJLEVBRVIsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlMLEVBQUtOLE9BQVNJLEVBQU1KLE9BQVFXLElBQUssQ0FZbkQsR0FYQWIsUUFBUUMsSUFBSSxtQkFDUk8sRUFBS0csR0FBS0wsRUFBTU0sSUFDbEJaLFFBQVFDLElBQUksR0FBR08sRUFBS0csUUFBUUwsRUFBTU0sTUFDbENGLEVBQU9HLEdBQUtMLEVBQUtHLEdBQ2pCQSxNQUVBRCxFQUFPRyxHQUFLUCxFQUFNTSxHQUNsQlosUUFBUUMsSUFBSSxHQUFHSyxFQUFNTSxRQUFRSixFQUFLRyxNQUNsQ0MsS0FHRUEsR0FBS04sRUFBTUosT0FJYixPQUhBRixRQUFRQyxJQUFJLGdCQUNaUyxFQUFTQSxFQUFPSSxPQUFPTixFQUFLRCxNQUFNSSxJQUNsQ1gsUUFBUUMsSUFBSVMsR0FDTEEsRUFFVCxHQUFJQyxHQUFLSCxFQUFLTixPQUFRLENBQ3BCRixRQUFRQyxJQUFJLGVBQ1osSUFBSWMsRUFBV1QsRUFBTUMsTUFBTUssR0FNM0IsT0FMQVosUUFBUUMsSUFDTixHQUFHYywyQkFBa0NDLE1BQU1DLFFBQVFGLE1BRXJETCxFQUFTQSxFQUFPSSxPQUFPQyxHQUN2QmYsUUFBUUMsSUFBSVMsR0FDTEEsQ0FDVCxDQUNGLENBRUEsT0FEQVYsUUFBUUMsSUFBSVMsR0FDTEEsQ0FDVCxDQUNGLENDOURBLFNBQVNRLEVBQUtDLEVBQU1YLEVBQU8sS0FBTUYsRUFBUSxNQUN2QyxNQUFPLENBQUVhLE9BQU1YLE9BQU1GLFFBQ3ZCLENBMFVBLE1BQU1jLEVBQWMsQ0FBQ0MsRUFBTUMsRUFBUyxHQUFJQyxHQUFTLEtBQ2xDLE9BQVRGLElBR2UsT0FBZkEsRUFBS2YsT0FDUGMsRUFBWUMsRUFBS2YsTUFBTyxHQUFHZ0IsSUFBU0MsRUFBUyxPQUFTLFVBQVUsR0FFbEV2QixRQUFRQyxJQUFJLEdBQUdxQixJQUFTQyxFQUFTLE9BQVMsU0FBU0YsRUFBS0YsUUFDdEMsT0FBZEUsRUFBS2IsTUFDUFksRUFBWUMsRUFBS2IsS0FBTSxHQUFHYyxJQUFTQyxFQUFTLE9BQVMsVUFBVSxHQUNqRSxFQUlGLElBQ0lDLEVBdlZKLFdBQ0UsTUFBTUMsRUFBWSxDQUFDMUIsRUFBSzJCLEVBQVEsRUFBR0MsRUFBTTVCLEVBQUlHLE9BQVMsS0FDcEQsR0FBSXdCLEVBQVFDLEVBRVYsT0FEQTNCLFFBQVFDLElBQUksV0FDTCxLQUdULElBQUkyQixFQUFNQyxVQUFVRixFQUFNRCxHQUFTLEdBRW5DMUIsUUFBUUMsSUFBSSxTQUFTeUIsV0FBZTNCLEVBQUkyQixNQUN4QzFCLFFBQVFDLElBQUksT0FBTzBCLFdBQWE1QixFQUFJNEIsTUFDcEMzQixRQUFRQyxJQUFJLE9BQU8yQixXQUFhN0IsRUFBSTZCLE1BRXBDLElBQUlFLEVBQVVaLEVBQUtuQixFQUFJNkIsSUFLdkIsT0FKQUUsRUFBUXRCLEtBQU9pQixFQUFVMUIsRUFBSzJCLEVBQU9FLEVBQU0sR0FDM0NFLEVBQVF4QixNQUFRbUIsRUFBVTFCLEVBQUs2QixFQUFNLEVBQUdELEdBRXhDM0IsUUFBUUMsSUFBSSxvQkFBb0I2QixFQUFRWCxRQUNqQ1csQ0FBTyxFQVloQixJQUNJQyxFQVZnQixDQUFDQyxJQUNuQixJQUFLLElBQUluQixFQUFJLEVBQUdBLEVBQUltQixFQUFTOUIsT0FBUVcsSUFDL0JtQixFQUFTbkIsSUFBTW1CLEVBQVNuQixFQUFJLElBQzlCbUIsRUFBU3ZCLE9BQU9JLEVBQUcsR0FHdkIsT0FBT21CLENBQVEsRUFJRUMsQ0FERG5DLEVBd1RMLENBQUMsRUFBRyxFQUFHLEVBQUcsR0FBSSxFQUFHLEVBQUcsRUFBRyxFQUFHLEVBQUcsRUFBRyxFQUFHLEdBQUksS0FBTSxPQXRUdERvQyxFQUFPVCxFQUFVTSxHQUNqQkksRUFBaUIsR0FFckIsTUFBTUMsRUFBUyxDQUFDQyxFQUFPQyxFQUFZSixJQUNoQixNQUFiSSxHQUNGQSxFQUFZcEIsRUFBS21CLEdBQ2pCckMsUUFBUUMsSUFDTixhQUFhb0MsMEJBQThCQyxFQUFVbkIsb0JBQW9CbUIsRUFBVTlCLFFBRTlFOEIsSUFFTEQsRUFBUUMsRUFBVW5CLEtBQ3BCbUIsRUFBVTlCLEtBQU80QixFQUFPQyxFQUFPQyxFQUFVOUIsTUFDaEM2QixFQUFRQyxFQUFVbkIsS0FDM0JtQixFQUFVaEMsTUFBUThCLEVBQU9DLEVBQU9DLEVBQVVoQyxPQUNqQytCLEdBQVNDLEVBQVVuQixNQUM1Qm5CLFFBQVFDLElBQUkseUNBR1BxQyxHQUdIQyxFQUFnQkMsR0FDSyxNQUFyQkEsRUFBYWhDLE1BQ2ZSLFFBQVFDLElBQUksb0JBQW9CdUMsRUFBYXJCLFFBQ3RDcUIsR0FFRkQsRUFBYUMsRUFBYWhDLE1BRzdCaUMsRUFBTyxDQUFDSixFQUFPRyxFQUFlTixLQUNsQyxHQUFvQixNQUFoQk0sT0FFRyxJQUFJQSxFQUFhckIsTUFBUWtCLEVBQzlCLE9BQU9HLEVBQ0YsR0FBSUgsRUFBUUcsRUFBYXJCLEtBQzlCLE9BQU9zQixFQUFLSixFQUFPRyxFQUFhaEMsTUFDM0IsR0FBSTZCLEVBQVFHLEVBQWFyQixLQUM5QixPQUFPc0IsRUFBS0osRUFBT0csRUFBYWxDLE1BQ2xDLEdBR0lvQyxFQUFlckIsSUFDbkIsSUFBSXNCLEVBQVcsR0FFZixPQURBM0MsUUFBUUMsSUFBSW9CLEVBQUtGLE1BQ0EsTUFBYkUsRUFBS2IsTUFBOEIsTUFBZGEsRUFBS2YsT0FDNUJxQyxFQUFXQSxFQUFTN0IsT0FBT08sRUFBS0YsTUFFekJ3QixJQUVRLE1BQWJ0QixFQUFLYixPQUFjbUMsRUFBV0EsRUFBUzdCLE9BQU80QixFQUFZckIsRUFBS2IsUUFDbkVtQyxFQUFXQSxFQUFTN0IsT0FBT08sRUFBS0YsTUFDZCxNQUFkRSxFQUFLZixRQUFlcUMsRUFBV0EsRUFBUzdCLE9BQU80QixFQUFZckIsRUFBS2YsU0FFcEVOLFFBQVFDLElBQUkwQyxHQUNMQSxFQUFRLEVBR1hDLEVBQWEsQ0FDakJQLEVBQ0FRLEVBQWNYLEVBQ2RZLEVBQVdaLEVBQ1hhLEVBQVksTUFhWixHQVhBL0MsUUFBUUMsSUFDTixlQUFlb0MsS0FBU1EsRUFBWTFCLFFBQVEyQixFQUFTM0IsUUFBUTRCLE1BVTNERixFQUFZMUIsTUFBUWtCLEVBQU8sQ0FFN0IsR0FBd0IsTUFBcEJRLEVBQVlyQyxNQUFxQyxNQUFyQnFDLEVBQVl2QyxNQVMxQyxPQVJBTixRQUFRQyxJQUFJLDhCQUNaRCxRQUFRQyxJQUFJLGdCQUFnQjhDLEtBQzVCL0MsUUFBUUMsSUFBSSxlQUFlNkMsRUFBUzNCLFFBQ25CLFNBQWI0QixFQUNGRCxFQUFTeEMsTUFBUSxLQUVqQndDLEVBQVN0QyxLQUFPLEtBRVgwQixFQUlKLEdBQXdCLE1BQXBCVyxFQUFZckMsTUFBcUMsTUFBckJxQyxFQUFZdkMsTUFDL0NOLFFBQVFDLElBQUkseUJBQ0ssU0FBYjhDLEVBQ0ZELEVBQVN4QyxNQUFRdUMsRUFBWXJDLEtBRTdCc0MsRUFBU3RDLEtBQU9xQyxFQUFZckMsVUFLM0IsR0FBd0IsTUFBcEJxQyxFQUFZckMsTUFBcUMsTUFBckJxQyxFQUFZdkMsTUFDL0NOLFFBQVFDLElBQUksMEJBQ0ssU0FBYjhDLEdBQ0ZELEVBQVN4QyxNQUFRdUMsRUFBWXZDLE1BQzdCTixRQUFRQyxJQUFJLEdBQUc2QyxFQUFTM0IsZ0JBQWdCMEIsRUFBWTFCLGVBRXBEMkIsRUFBU3RDLEtBQU9xQyxFQUFZdkMsV0FLM0IsR0FBd0IsTUFBcEJ1QyxFQUFZckMsTUFBcUMsTUFBckJxQyxFQUFZdkMsTUFBZSxDQUM5RE4sUUFBUUMsSUFBSSx3QkFFWixJQUFJK0MsRUFBWVQsRUFBYU0sRUFBWXZDLE9BQ3pDdUMsRUFBWTFCLEtBQU82QixFQUFVN0IsS0FDN0I2QixFQUFVN0IsS0FBT2tCLEVBQ2pCakIsRUFBWWMsR0FDWlUsRUFBV1AsRUFBT1EsRUFBWXZDLE1BQU91QyxFQUFhLFFBQ3BELENBQ0EsT0FBT1gsQ0FDVCxDQUdTRyxFQUFRUSxFQUFZMUIsS0FDM0J5QixFQUFXUCxFQUFPUSxFQUFZckMsS0FBTXFDLEVBQWEsUUFJMUNSLEVBQVFRLEVBQVkxQixNQUMzQnlCLEVBQVdQLEVBQU9RLEVBQVl2QyxNQUFPdUMsRUFBYSxRQUNwRCxFQUdJSSxFQUFhLENBQUNDLEVBQVVDLEVBQVEsQ0FBQ2pCLE1BQ3JDLEdBQWdCLE1BQVpnQixFQUNGLE1BQU0sSUFBSUUsTUFBTSxnQ0FHbEIsR0FBb0IsR0FBaEJELEVBQU1qRCxRQUdOaUQsR0FBUyxHQUFJLENBQ2YsSUFBSTlCLEVBQU84QixFQUFNLEdBQ2pCRCxFQUFTN0IsR0FDUSxNQUFiQSxFQUFLYixNQUNQMkMsRUFBTUUsS0FBS2hDLEVBQUtiLE1BRUEsTUFBZGEsRUFBS2YsT0FDUDZDLEVBQU1FLEtBQUtoQyxFQUFLZixPQUVsQjZDLEVBQU1HLFFBQ05MLEVBQVdDLEVBQVVDLEVBQ3ZCLEdBR0lJLEVBQVcsQ0FBQ0wsRUFBVUMsRUFBUSxDQUFDakIsTUFDbkMsR0FBb0IsR0FBaEJpQixFQUFNakQsT0FFSCxDQUNMLElBQUltQixFQUFPOEIsRUFBTSxHQVdqQixPQVZBRCxFQUFTN0IsR0FDVDhCLEVBQU1HLFFBQ1csTUFBYmpDLEVBQUtiLE9BQ1AyQyxFQUFNRSxLQUFLaEMsRUFBS2IsTUFDaEIrQyxFQUFTTCxFQUFVQyxTQUVILE1BQWQ5QixFQUFLZixRQUNQNkMsRUFBTUUsS0FBS2hDLEVBQUtmLE9BQ2hCaUQsRUFBU0wsRUFBVUMsSUFHdkIsR0FHSUssRUFBVSxDQUFDTixFQUFVTyxFQUFRLENBQUN2QixNQUNsQyxJQUNJYixFQUFPb0MsRUFEREEsRUFBTXZELE9BQVMsR0FFekIsR0FBaUIsTUFBYm1CLEVBQUtiLE1BQThCLE1BQWRhLEVBQUtmLE1BRzVCLE9BRkE0QyxFQUFTN0IsUUFDVG9DLEVBQU1DLE1BR1MsTUFBYnJDLEVBQUtiLE9BQ1BpRCxFQUFNSixLQUFLaEMsRUFBS2IsTUFDaEJnRCxFQUFRTixFQUFVTyxJQUVwQlAsRUFBUzdCLEdBQ1RvQyxFQUFNQyxNQUNZLE1BQWRyQyxFQUFLZixRQUNQbUQsRUFBTUosS0FBS2hDLEVBQUtmLE9BQ2hCa0QsRUFBUU4sRUFBVU8sR0FFZCxFQUdGRSxFQUFZLENBQUNULEVBQVVPLEVBQVEsQ0FBQ3ZCLE1BQ3BDLElBQ0liLEVBQU9vQyxFQUREQSxFQUFNdkQsT0FBUyxHQUVSLE1BQWJtQixFQUFLYixNQUE4QixNQUFkYSxFQUFLZixPQUM1QjRDLEVBQVM3QixHQUNUb0MsRUFBTUMsUUFFVyxNQUFickMsRUFBS2IsT0FDUGlELEVBQU1KLEtBQUtoQyxFQUFLYixNQUNoQm1ELEVBQVVULEVBQVVPLElBRUosTUFBZHBDLEVBQUtmLFFBQ1BtRCxFQUFNSixLQUFLaEMsRUFBS2YsT0FDaEJxRCxFQUFVVCxFQUFVTyxJQUV0QlAsRUFBUzdCLEdBQ1RvQyxFQUFNQyxNQUNSLEVBR0lFLEVBQVMsQ0FBQ3ZDLEVBQU13QyxFQUFRLEVBQUdDLEVBQVcsS0FDMUM5RCxRQUFRQyxJQUNOLFlBQVk0RCxpQkFBcUJDLGFBQW9CekMsRUFBS0YsUUFFMUMsTUFBYkUsRUFBS2IsS0FBK0IsTUFBZGEsRUFBS2YsT0FDMUJ1RCxFQUFRQyxJQUNWQSxFQUFXRCxHQUViQSxFQUFRLEVBQ0RDLElBRVUsTUFBYnpDLEVBQUtiLE9BQ1BxRCxJQUNBQyxFQUFXRixFQUFPdkMsRUFBS2IsS0FBTXFELEVBQU9DLEdBQ3BDRCxFQUFRLEdBRVEsTUFBZHhDLEVBQUtmLFFBQ1B1RCxJQUNBQyxFQUFXRixFQUFPdkMsRUFBS2YsTUFBT3VELEVBQU9DLEdBQ3JDRCxFQUFRLEdBR0hDLElBSUxDLEVBQVEsQ0FBQzFDLEVBQU0yQyxFQUFVOUIsRUFBTTJCLEVBQVEsSUFDdkNHLEdBQVczQyxFQUNOd0MsRUFFSHhDLEVBQUtGLEtBQU82QyxFQUFRN0MsTUFDdEIwQyxJQUNPRSxFQUFNMUMsRUFBTTJDLEVBQVExRCxNQUFPdUQsSUFDekJ4QyxFQUFLRixLQUFPNkMsRUFBUTdDLE1BQzdCMEMsSUFDT0UsRUFBTTFDLEVBQU0yQyxFQUFReEQsS0FBTXFELFNBRjVCLEVBeUJMSSxFQUFjNUMsSUFDbEJjLEVBQWVrQixLQUFLaEMsRUFBS0YsS0FBSyxFQUdoQyxNQUFPLENBQ0xlLE9BQ0FFLFNBQ0FHLGVBQ0FFLE9BQ0FDLGNBQ0FFLGFBQ0FLLGFBQ0FNLFdBQ0FDLFVBQ0FHLFlBQ0FDLFNBQ0FHLFFBQ0FHLFdBbkNpQixLQUNqQmxFLFFBQVFDLElBQUksYUFBYWlDLEVBQUtmLFVBQ25CZixLQUFLK0QsSUFBSVAsRUFBTzFCLEVBQUs1QixPQUFTc0QsRUFBTzFCLEVBQUsxQixPQUMxQyxJQWlDWDRELFVBN0JnQixLQUNoQmpDLEVBQWlCLEdBQ2pCcUIsRUFBUVMsR0FFUmpFLFFBQVFDLElBQUlrQyxHQUNaLElBQUlrQyxFQUFVNUMsRUFBVVUsR0FDeEJELEVBQUtmLEtBQU9rRCxFQUFRbEQsS0FDcEJlLEVBQUsxQixLQUFPNkQsRUFBUTdELEtBQ3BCMEIsRUFBSzVCLE1BQVErRCxFQUFRL0QsS0FBSyxFQXVCOUIsQ0FpQmNnRSxHQUVkOUMsRUFBUVksT0FBTyxJQUNmWixFQUFRWSxPQUFPLElBQ2ZaLEVBQVFZLE9BQU8sSUFDZlosRUFBUVksT0FBTyxJQUNmWixFQUFRWSxPQUFPLElBQ2ZoQixFQUFZSSxFQUFRVSxNQUtwQlYsRUFBUW9CLFdBQVcsR0FDbkJ4QixFQUFZSSxFQUFRVSxNQWNwQmxDLFFBQVFDLElBQUksZUFBZXVCLEVBQVEwQyxnQkFDbkMxQyxFQUFRNEMsWUFDUmhELEVBQVlJLEVBQVFVLE1BQ3BCbEMsUUFBUUMsSUFBSSxlQUFldUIsRUFBUTBDLGUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ic3QvLi9zcmMvbWVyZ2UuanMiLCJ3ZWJwYWNrOi8vYnN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGZpYlJlYyhudW0pIHtcbiAgaWYgKG51bSA9PSAwKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9IGVsc2UgaWYgKG51bSA9PSAxKSB7XG4gICAgcmV0dXJuIFswXTtcbiAgfSBlbHNlIGlmIChudW0gPT0gMikge1xuICAgIHJldHVybiBbMCwgMV07XG4gIH1cbiAgbGV0IGFycmF5ID0gZmliUmVjKG51bSAtIDEpO1xuICByZXR1cm4gYXJyYXkuY29uY2F0KGFycmF5W251bSAtIDNdICsgYXJyYXlbbnVtIC0gMl0pO1xufVxuXG5mdW5jdGlvbiBtZXJnZVNvcnQoYXJyKSB7XG4gIGNvbnNvbGUubG9nKGBhcnIgJHthcnJ9YCk7XG5cbiAgaWYgKGFyci5sZW5ndGggPT0gMCkge1xuICAgIHJldHVybiBbXTtcbiAgfSBlbHNlIGlmIChhcnIubGVuZ3RoID09IDEpIHtcbiAgICByZXR1cm4gYXJyO1xuICB9IGVsc2Uge1xuICAgIGxldCBkaXZpZGUgPSBNYXRoLmZsb29yKGFyci5sZW5ndGggLyAyKTtcbiAgICBsZXQgcmlnaHQgPSBtZXJnZVNvcnQoYXJyLnNsaWNlKGRpdmlkZSkpO1xuICAgIGxldCBsZWZ0ID0gbWVyZ2VTb3J0KGFyci5zcGxpY2UoMCwgYXJyLmxlbmd0aCAtIHJpZ2h0Lmxlbmd0aCkpO1xuXG4gICAgY29uc29sZS5sb2coYGRpdmlkZSAke2RpdmlkZX1gKTtcbiAgICBjb25zb2xlLmxvZyhgcmlnaHQgJHtyaWdodH1gKTtcbiAgICBjb25zb2xlLmxvZyhgbGVmdCAke2xlZnR9YCk7XG5cbiAgICBsZXQgbWVyZ2VkID0gW107XG4gICAgbGV0IGwgPSAwO1xuICAgIGxldCByID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVmdC5sZW5ndGggKyByaWdodC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc29sZS5sb2coXCJpbiB0aGUgZm9yIGxvb3BcIik7XG4gICAgICBpZiAobGVmdFtsXSA8IHJpZ2h0W3JdKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke2xlZnRbbF19IDwgJHtyaWdodFtyXX1gKTtcbiAgICAgICAgbWVyZ2VkW2ldID0gbGVmdFtsXTtcbiAgICAgICAgbCsrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWVyZ2VkW2ldID0gcmlnaHRbcl07XG4gICAgICAgIGNvbnNvbGUubG9nKGAke3JpZ2h0W3JdfSA8ICR7bGVmdFtsXX1gKTtcbiAgICAgICAgcisrO1xuICAgICAgfVxuXG4gICAgICBpZiAociA9PSByaWdodC5sZW5ndGgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJlbmQgb2YgcmlnaHRcIik7XG4gICAgICAgIG1lcmdlZCA9IG1lcmdlZC5jb25jYXQobGVmdC5zbGljZShsKSk7XG4gICAgICAgIGNvbnNvbGUubG9nKG1lcmdlZCk7XG4gICAgICAgIHJldHVybiBtZXJnZWQ7XG4gICAgICB9XG4gICAgICBpZiAobCA9PSBsZWZ0Lmxlbmd0aCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImVuZCBvZiBsZWZ0XCIpO1xuICAgICAgICBsZXQgbGVmdG92ZXIgPSByaWdodC5zbGljZShyKTtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYCR7bGVmdG92ZXJ9IGlzIGxlZnQgYW5kIGlzIGFycmF5PyAke0FycmF5LmlzQXJyYXkobGVmdG92ZXIpfWBcbiAgICAgICAgKTtcbiAgICAgICAgbWVyZ2VkID0gbWVyZ2VkLmNvbmNhdChsZWZ0b3Zlcik7XG4gICAgICAgIGNvbnNvbGUubG9nKG1lcmdlZCk7XG4gICAgICAgIHJldHVybiBtZXJnZWQ7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKG1lcmdlZCk7XG4gICAgcmV0dXJuIG1lcmdlZDtcbiAgfVxufVxuXG5leHBvcnQgeyBtZXJnZVNvcnQgfTtcbiIsImltcG9ydCB7IG1lcmdlU29ydCB9IGZyb20gXCIuL21lcmdlXCI7XG5cbmZ1bmN0aW9uIE5vZGUoZGF0YSwgbGVmdCA9IG51bGwsIHJpZ2h0ID0gbnVsbCkge1xuICByZXR1cm4geyBkYXRhLCBsZWZ0LCByaWdodCB9O1xufVxuXG5mdW5jdGlvbiBUcmVlKGFycmF5KSB7XG4gIGNvbnN0IGJ1aWxkVHJlZSA9IChhcnIsIHN0YXJ0ID0gMCwgZW5kID0gYXJyLmxlbmd0aCAtIDEpID0+IHtcbiAgICBpZiAoc3RhcnQgPiBlbmQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwibnVsbCEhIVwiKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCBtaWQgPSBwYXJzZUludCgoZW5kICsgc3RhcnQpIC8gMik7XG5cbiAgICBjb25zb2xlLmxvZyhgc3RhcnQgJHtzdGFydH0gdmFsdWUgJHthcnJbc3RhcnRdfWApO1xuICAgIGNvbnNvbGUubG9nKGBlbmQgJHtlbmR9IHZhbHVlICR7YXJyW2VuZF19YCk7XG4gICAgY29uc29sZS5sb2coYG1pZCAke21pZH0gdmFsdWUgJHthcnJbbWlkXX1gKTtcblxuICAgIGxldCBuZXdOb2RlID0gTm9kZShhcnJbbWlkXSk7XG4gICAgbmV3Tm9kZS5sZWZ0ID0gYnVpbGRUcmVlKGFyciwgc3RhcnQsIG1pZCAtIDEpO1xuICAgIG5ld05vZGUucmlnaHQgPSBidWlsZFRyZWUoYXJyLCBtaWQgKyAxLCBlbmQpO1xuXG4gICAgY29uc29sZS5sb2coYG5ldyBub2RlIGRhdGEgaXMgJHtuZXdOb2RlLmRhdGF9YCk7XG4gICAgcmV0dXJuIG5ld05vZGU7XG4gIH07XG5cbiAgY29uc3QgcmVtb3ZlRHVwZXMgPSAoYXJyYXlyYXkpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5cmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYXJyYXlyYXlbaV0gPT0gYXJyYXlyYXlbaSArIDFdKSB7XG4gICAgICAgIGFycmF5cmF5LnNwbGljZShpLCAxKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGFycmF5cmF5O1xuICB9O1xuXG4gIGxldCBzb3J0ZWRBcnJheSA9IG1lcmdlU29ydChhcnJheSk7XG4gIGxldCBub0R1cGVzQXJyYXkgPSByZW1vdmVEdXBlcyhzb3J0ZWRBcnJheSk7XG4gIGxldCByb290ID0gYnVpbGRUcmVlKG5vRHVwZXNBcnJheSk7XG4gIGxldCByZWJhbGFuY2VBcnJheSA9IFtdO1xuXG4gIGNvbnN0IGluc2VydCA9ICh2YWx1ZSwgY2hlY2tOb2RlID0gcm9vdCkgPT4ge1xuICAgIGlmIChjaGVja05vZGUgPT0gbnVsbCkge1xuICAgICAgY2hlY2tOb2RlID0gTm9kZSh2YWx1ZSk7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYGluc2VydGluZyAke3ZhbHVlfS4uLiBjaGVja05vZGUuZGF0YSBpcyAke2NoZWNrTm9kZS5kYXRhfSBhbmQgbGVmdCBpcyAke2NoZWNrTm9kZS5sZWZ0fWBcbiAgICAgICk7XG4gICAgICByZXR1cm4gY2hlY2tOb2RlO1xuICAgIH1cbiAgICBpZiAodmFsdWUgPCBjaGVja05vZGUuZGF0YSkge1xuICAgICAgY2hlY2tOb2RlLmxlZnQgPSBpbnNlcnQodmFsdWUsIGNoZWNrTm9kZS5sZWZ0KTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlID4gY2hlY2tOb2RlLmRhdGEpIHtcbiAgICAgIGNoZWNrTm9kZS5yaWdodCA9IGluc2VydCh2YWx1ZSwgY2hlY2tOb2RlLnJpZ2h0KTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlID09IGNoZWNrTm9kZS5kYXRhKSB7XG4gICAgICBjb25zb2xlLmxvZyhcInNvcnJ5IGNhbid0IGluc2VydCwgaXQgYWxyZWFkeSBleGlzdHNcIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNoZWNrTm9kZTtcbiAgfTtcblxuICBjb25zdCBmaW5kTGVmdExlYWYgPSAoc3RhcnRpbmdOb2RlKSA9PiB7XG4gICAgaWYgKHN0YXJ0aW5nTm9kZS5sZWZ0ID09IG51bGwpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBsZWZ0bW9zdCBsZWFmIGlzICR7c3RhcnRpbmdOb2RlLmRhdGF9YCk7XG4gICAgICByZXR1cm4gc3RhcnRpbmdOb2RlO1xuICAgIH1cbiAgICByZXR1cm4gZmluZExlZnRMZWFmKHN0YXJ0aW5nTm9kZS5sZWZ0KTtcbiAgfTtcblxuICBjb25zdCBmaW5kID0gKHZhbHVlLCBzdGFydGluZ05vZGUgPSByb290KSA9PiB7XG4gICAgaWYgKHN0YXJ0aW5nTm9kZSA9PSBudWxsKSB7XG4gICAgICAvL2RvIG5vdGhpbmdcbiAgICB9IGVsc2UgaWYgKHN0YXJ0aW5nTm9kZS5kYXRhID09IHZhbHVlKSB7XG4gICAgICByZXR1cm4gc3RhcnRpbmdOb2RlO1xuICAgIH0gZWxzZSBpZiAodmFsdWUgPCBzdGFydGluZ05vZGUuZGF0YSkge1xuICAgICAgcmV0dXJuIGZpbmQodmFsdWUsIHN0YXJ0aW5nTm9kZS5sZWZ0KTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlID4gc3RhcnRpbmdOb2RlLmRhdGEpIHtcbiAgICAgIHJldHVybiBmaW5kKHZhbHVlLCBzdGFydGluZ05vZGUucmlnaHQpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCB0cmVlVG9BcnJheSA9IChub2RlKSA9PiB7XG4gICAgbGV0IG5ld0FycmF5ID0gW107XG4gICAgY29uc29sZS5sb2cobm9kZS5kYXRhKTtcbiAgICBpZiAobm9kZS5sZWZ0ID09IG51bGwgJiYgbm9kZS5yaWdodCA9PSBudWxsKSB7XG4gICAgICBuZXdBcnJheSA9IG5ld0FycmF5LmNvbmNhdChub2RlLmRhdGEpO1xuXG4gICAgICByZXR1cm4gbmV3QXJyYXk7XG4gICAgfVxuICAgIGlmIChub2RlLmxlZnQgIT0gbnVsbCkgbmV3QXJyYXkgPSBuZXdBcnJheS5jb25jYXQodHJlZVRvQXJyYXkobm9kZS5sZWZ0KSk7XG4gICAgbmV3QXJyYXkgPSBuZXdBcnJheS5jb25jYXQobm9kZS5kYXRhKTtcbiAgICBpZiAobm9kZS5yaWdodCAhPSBudWxsKSBuZXdBcnJheSA9IG5ld0FycmF5LmNvbmNhdCh0cmVlVG9BcnJheShub2RlLnJpZ2h0KSk7XG5cbiAgICBjb25zb2xlLmxvZyhuZXdBcnJheSk7XG4gICAgcmV0dXJuIG5ld0FycmF5O1xuICB9O1xuXG4gIGNvbnN0IGRlbGV0ZUl0ZW0gPSAoXG4gICAgdmFsdWUsXG4gICAgY3VycmVudE5vZGUgPSByb290LFxuICAgIHByZXZOb2RlID0gcm9vdCxcbiAgICBkaXJlY3Rpb24gPSBcIlwiXG4gICkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYERlbGV0ZUl0ZW0gKCR7dmFsdWV9LCR7Y3VycmVudE5vZGUuZGF0YX0sJHtwcmV2Tm9kZS5kYXRhfSwke2RpcmVjdGlvbn0pYFxuICAgICk7XG5cbiAgICAvL3doaWNoIHBhdGggZGlkIHRoZSBwcmV2aW91cyBub2RlIGNvbWVcbiAgICAvLyBsZXQgZGlyZWN0aW9uID0gXCJsZWZ0XCI7XG4gICAgLy8gaWYgKHByZXZOb2RlLmRhdGEgPCBjdXJyZW50Tm9kZS5kYXRhKSB7XG4gICAgLy8gICBkaXJlY3Rpb24gPSBcInJpZ2h0XCI7XG4gICAgLy8gfVxuXG4gICAgLy9mb3VuZCB0aGUgdmFsdWVcbiAgICBpZiAoY3VycmVudE5vZGUuZGF0YSA9PSB2YWx1ZSkge1xuICAgICAgLy9pdCdzIGEgbGVhZiwganVzdCBkZWxldGUgaXRcbiAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IG51bGwgJiYgY3VycmVudE5vZGUucmlnaHQgPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIml0cyBhIGxlYWYhIGxldHMgZGVsZXRlIGl0XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhgZGlyZWN0aW9uIGlzICR7ZGlyZWN0aW9ufWApO1xuICAgICAgICBjb25zb2xlLmxvZyhgcHJldk5vZGUgaXMgJHtwcmV2Tm9kZS5kYXRhfWApO1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwicmlnaHRcIikge1xuICAgICAgICAgIHByZXZOb2RlLnJpZ2h0ID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcmV2Tm9kZS5sZWZ0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgIH1cblxuICAgICAgLy9pdCBvbmx5IGhhcyBsZWZ0IHN1YnRyZWVcbiAgICAgIGVsc2UgaWYgKGN1cnJlbnROb2RlLmxlZnQgIT0gbnVsbCAmJiBjdXJyZW50Tm9kZS5yaWdodCA9PSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwib25seSBoYXMgbGVmdCBzdWJ0cmVlXCIpO1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwicmlnaHRcIikge1xuICAgICAgICAgIHByZXZOb2RlLnJpZ2h0ID0gY3VycmVudE5vZGUubGVmdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcmV2Tm9kZS5sZWZ0ID0gY3VycmVudE5vZGUubGVmdDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvL2l0IG9ubHkgaGFzIHJpZ2h0IHN1YnRyZWVcbiAgICAgIGVsc2UgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gbnVsbCAmJiBjdXJyZW50Tm9kZS5yaWdodCAhPSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwib25seSBoYXMgcmlnaHQgc3VidHJlZVwiKTtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICBwcmV2Tm9kZS5yaWdodCA9IGN1cnJlbnROb2RlLnJpZ2h0O1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAke3ByZXZOb2RlLmRhdGF9LnJpZ2h0ID0gJHtjdXJyZW50Tm9kZS5kYXRhfS5yaWdodGApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByZXZOb2RlLmxlZnQgPSBjdXJyZW50Tm9kZS5yaWdodDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvL2l0IGhhcyB0d28gc3VidHJlZXNcbiAgICAgIGVsc2UgaWYgKGN1cnJlbnROb2RlLmxlZnQgIT0gbnVsbCAmJiBjdXJyZW50Tm9kZS5yaWdodCAhPSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiaXQgaGFzIHR3byBzdWJ0cmVlcyFcIik7XG4gICAgICAgIC8vZmluZCBuZXh0IGJpZ2dlc3Qgbm9kZVxuICAgICAgICBsZXQgZm91bmRMZWFmID0gZmluZExlZnRMZWFmKGN1cnJlbnROb2RlLnJpZ2h0KTtcbiAgICAgICAgY3VycmVudE5vZGUuZGF0YSA9IGZvdW5kTGVhZi5kYXRhO1xuICAgICAgICBmb3VuZExlYWYuZGF0YSA9IHZhbHVlO1xuICAgICAgICBwcmV0dHlQcmludChyb290KTtcbiAgICAgICAgZGVsZXRlSXRlbSh2YWx1ZSwgY3VycmVudE5vZGUucmlnaHQsIGN1cnJlbnROb2RlLCBcInJpZ2h0XCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuXG4gICAgLy90cmF2ZXJzZSB0aGUgbGVmdCB0cmVlXG4gICAgZWxzZSBpZiAodmFsdWUgPCBjdXJyZW50Tm9kZS5kYXRhKSB7XG4gICAgICBkZWxldGVJdGVtKHZhbHVlLCBjdXJyZW50Tm9kZS5sZWZ0LCBjdXJyZW50Tm9kZSwgXCJsZWZ0XCIpO1xuICAgIH1cblxuICAgIC8vdHJhdmVyc2UgcmlnaHQgdHJlZVxuICAgIGVsc2UgaWYgKHZhbHVlID4gY3VycmVudE5vZGUuZGF0YSkge1xuICAgICAgZGVsZXRlSXRlbSh2YWx1ZSwgY3VycmVudE5vZGUucmlnaHQsIGN1cnJlbnROb2RlLCBcInJpZ2h0XCIpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBsZXZlbE9yZGVyID0gKGNhbGxiYWNrLCBxdWV1ZSA9IFtyb290XSkgPT4ge1xuICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ5b3UgbmVlZCBhIGNhbGxiYWNrIGZ1bmN0aW9uXCIpO1xuICAgIH1cbiAgICAvL3VzZSBwdXNoIGFuZCBzaGlmdFxuICAgIGlmIChxdWV1ZS5sZW5ndGggPT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocXVldWUgIT0gW10pIHtcbiAgICAgIGxldCBub2RlID0gcXVldWVbMF07XG4gICAgICBjYWxsYmFjayhub2RlKTtcbiAgICAgIGlmIChub2RlLmxlZnQgIT0gbnVsbCkge1xuICAgICAgICBxdWV1ZS5wdXNoKG5vZGUubGVmdCk7XG4gICAgICB9XG4gICAgICBpZiAobm9kZS5yaWdodCAhPSBudWxsKSB7XG4gICAgICAgIHF1ZXVlLnB1c2gobm9kZS5yaWdodCk7XG4gICAgICB9XG4gICAgICBxdWV1ZS5zaGlmdCgpO1xuICAgICAgbGV2ZWxPcmRlcihjYWxsYmFjaywgcXVldWUpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBwcmVPcmRlciA9IChjYWxsYmFjaywgcXVldWUgPSBbcm9vdF0pID0+IHtcbiAgICBpZiAocXVldWUubGVuZ3RoID09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG5vZGUgPSBxdWV1ZVswXTtcbiAgICAgIGNhbGxiYWNrKG5vZGUpO1xuICAgICAgcXVldWUuc2hpZnQoKTtcbiAgICAgIGlmIChub2RlLmxlZnQgIT0gbnVsbCkge1xuICAgICAgICBxdWV1ZS5wdXNoKG5vZGUubGVmdCk7XG4gICAgICAgIHByZU9yZGVyKGNhbGxiYWNrLCBxdWV1ZSk7XG4gICAgICB9XG4gICAgICBpZiAobm9kZS5yaWdodCAhPSBudWxsKSB7XG4gICAgICAgIHF1ZXVlLnB1c2gobm9kZS5yaWdodCk7XG4gICAgICAgIHByZU9yZGVyKGNhbGxiYWNrLCBxdWV1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGluT3JkZXIgPSAoY2FsbGJhY2ssIHN0YWNrID0gW3Jvb3RdKSA9PiB7XG4gICAgbGV0IHRvcCA9IHN0YWNrLmxlbmd0aCAtIDE7XG4gICAgbGV0IG5vZGUgPSBzdGFja1t0b3BdO1xuICAgIGlmIChub2RlLmxlZnQgPT0gbnVsbCAmJiBub2RlLnJpZ2h0ID09IG51bGwpIHtcbiAgICAgIGNhbGxiYWNrKG5vZGUpO1xuICAgICAgc3RhY2sucG9wKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChub2RlLmxlZnQgIT0gbnVsbCkge1xuICAgICAgc3RhY2sucHVzaChub2RlLmxlZnQpO1xuICAgICAgaW5PcmRlcihjYWxsYmFjaywgc3RhY2spO1xuICAgIH1cbiAgICBjYWxsYmFjayhub2RlKTtcbiAgICBzdGFjay5wb3AoKTtcbiAgICBpZiAobm9kZS5yaWdodCAhPSBudWxsKSB7XG4gICAgICBzdGFjay5wdXNoKG5vZGUucmlnaHQpO1xuICAgICAgaW5PcmRlcihjYWxsYmFjaywgc3RhY2spO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH07XG5cbiAgY29uc3QgcG9zdE9yZGVyID0gKGNhbGxiYWNrLCBzdGFjayA9IFtyb290XSkgPT4ge1xuICAgIGxldCB0b3AgPSBzdGFjay5sZW5ndGggLSAxO1xuICAgIGxldCBub2RlID0gc3RhY2tbdG9wXTtcbiAgICBpZiAobm9kZS5sZWZ0ID09IG51bGwgJiYgbm9kZS5yaWdodCA9PSBudWxsKSB7XG4gICAgICBjYWxsYmFjayhub2RlKTtcbiAgICAgIHN0YWNrLnBvcCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAobm9kZS5sZWZ0ICE9IG51bGwpIHtcbiAgICAgICAgc3RhY2sucHVzaChub2RlLmxlZnQpO1xuICAgICAgICBwb3N0T3JkZXIoY2FsbGJhY2ssIHN0YWNrKTtcbiAgICAgIH1cbiAgICAgIGlmIChub2RlLnJpZ2h0ICE9IG51bGwpIHtcbiAgICAgICAgc3RhY2sucHVzaChub2RlLnJpZ2h0KTtcbiAgICAgICAgcG9zdE9yZGVyKGNhbGxiYWNrLCBzdGFjayk7XG4gICAgICB9XG4gICAgICBjYWxsYmFjayhub2RlKTtcbiAgICAgIHN0YWNrLnBvcCgpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBoZWlnaHQgPSAobm9kZSwgY291bnQgPSAwLCBtYXhjb3VudCA9IDApID0+IHtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGBjb3VudCBpcyAke2NvdW50fSBtYXhjb3VudCBpcyAke21heGNvdW50fSBub2RlIGlzICR7bm9kZS5kYXRhfWBcbiAgICApO1xuICAgIGlmICgobm9kZS5sZWZ0ID09IG51bGwpICYgKG5vZGUucmlnaHQgPT0gbnVsbCkpIHtcbiAgICAgIGlmIChjb3VudCA+IG1heGNvdW50KSB7XG4gICAgICAgIG1heGNvdW50ID0gY291bnQ7XG4gICAgICB9XG4gICAgICBjb3VudCA9IDA7XG4gICAgICByZXR1cm4gbWF4Y291bnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChub2RlLmxlZnQgIT0gbnVsbCkge1xuICAgICAgICBjb3VudCsrO1xuICAgICAgICBtYXhjb3VudCA9IGhlaWdodChub2RlLmxlZnQsIGNvdW50LCBtYXhjb3VudCk7XG4gICAgICAgIGNvdW50ID0gMDtcbiAgICAgIH1cbiAgICAgIGlmIChub2RlLnJpZ2h0ICE9IG51bGwpIHtcbiAgICAgICAgY291bnQrKztcbiAgICAgICAgbWF4Y291bnQgPSBoZWlnaHQobm9kZS5yaWdodCwgY291bnQsIG1heGNvdW50KTtcbiAgICAgICAgY291bnQgPSAwO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbWF4Y291bnQ7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGRlcHRoID0gKG5vZGUsIHBvaW50ZXIgPSByb290LCBjb3VudCA9IDApID0+IHtcbiAgICBpZiAocG9pbnRlciA9PSBub2RlKSB7XG4gICAgICByZXR1cm4gY291bnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChub2RlLmRhdGEgPiBwb2ludGVyLmRhdGEpIHtcbiAgICAgICAgY291bnQrKztcbiAgICAgICAgcmV0dXJuIGRlcHRoKG5vZGUsIHBvaW50ZXIucmlnaHQsIGNvdW50KTtcbiAgICAgIH0gZWxzZSBpZiAobm9kZS5kYXRhIDwgcG9pbnRlci5kYXRhKSB7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICAgIHJldHVybiBkZXB0aChub2RlLCBwb2ludGVyLmxlZnQsIGNvdW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaXNCYWxhbmNlZCA9ICgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgcm9vdC5kYXRhICR7cm9vdC5kYXRhfWApO1xuICAgIGxldCBkaWZmID0gTWF0aC5hYnMoaGVpZ2h0KHJvb3QucmlnaHQpIC0gaGVpZ2h0KHJvb3QubGVmdCkpO1xuICAgIGlmIChkaWZmID4gMSkgcmV0dXJuIGZhbHNlO1xuICAgIGVsc2UgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgY29uc3QgcmViYWxhbmNlID0gKCkgPT4ge1xuICAgIHJlYmFsYW5jZUFycmF5ID0gW107XG4gICAgaW5PcmRlcihhZGRUb0FycmF5KTtcbiAgICAvL2NvbnNvbGUubG9nKHJlYmFsYW5jZUFycmF5KTtcbiAgICBjb25zb2xlLmxvZyhyZWJhbGFuY2VBcnJheSk7XG4gICAgbGV0IG5ld1Jvb3QgPSBidWlsZFRyZWUocmViYWxhbmNlQXJyYXkpO1xuICAgIHJvb3QuZGF0YSA9IG5ld1Jvb3QuZGF0YTtcbiAgICByb290LmxlZnQgPSBuZXdSb290LmxlZnQ7XG4gICAgcm9vdC5yaWdodCA9IG5ld1Jvb3QucmlnaHQ7XG4gIH07XG5cbiAgY29uc3QgYWRkVG9BcnJheSA9IChub2RlKSA9PiB7XG4gICAgcmViYWxhbmNlQXJyYXkucHVzaChub2RlLmRhdGEpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcm9vdCxcbiAgICBpbnNlcnQsXG4gICAgZmluZExlZnRMZWFmLFxuICAgIGZpbmQsXG4gICAgdHJlZVRvQXJyYXksXG4gICAgZGVsZXRlSXRlbSxcbiAgICBsZXZlbE9yZGVyLFxuICAgIHByZU9yZGVyLFxuICAgIGluT3JkZXIsXG4gICAgcG9zdE9yZGVyLFxuICAgIGhlaWdodCxcbiAgICBkZXB0aCxcbiAgICBpc0JhbGFuY2VkLFxuICAgIHJlYmFsYW5jZSxcbiAgfTtcbn1cblxuY29uc3QgcHJldHR5UHJpbnQgPSAobm9kZSwgcHJlZml4ID0gXCJcIiwgaXNMZWZ0ID0gdHJ1ZSkgPT4ge1xuICBpZiAobm9kZSA9PT0gbnVsbCkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAobm9kZS5yaWdodCAhPT0gbnVsbCkge1xuICAgIHByZXR0eVByaW50KG5vZGUucmlnaHQsIGAke3ByZWZpeH0ke2lzTGVmdCA/IFwi4pSCICAgXCIgOiBcIiAgICBcIn1gLCBmYWxzZSk7XG4gIH1cbiAgY29uc29sZS5sb2coYCR7cHJlZml4fSR7aXNMZWZ0ID8gXCLilJTilIDilIAgXCIgOiBcIuKUjOKUgOKUgCBcIn0ke25vZGUuZGF0YX1gKTtcbiAgaWYgKG5vZGUubGVmdCAhPT0gbnVsbCkge1xuICAgIHByZXR0eVByaW50KG5vZGUubGVmdCwgYCR7cHJlZml4fSR7aXNMZWZ0ID8gXCIgICAgXCIgOiBcIuKUgiAgIFwifWAsIHRydWUpO1xuICB9XG59O1xuXG4vL1RFU1RJTkcvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbmxldCBuZXdBcnJheSA9IFsxLCA3LCA0LCAyMywgOCwgOSwgNCwgMywgNSwgNywgOSwgNjcsIDYzNDUsIDMyNF07XG5sZXQgbmV3VHJlZSA9IFRyZWUobmV3QXJyYXkpO1xuLy8gcHJldHR5UHJpbnQobmV3VHJlZS5yb290KTtcbm5ld1RyZWUuaW5zZXJ0KDU0KTtcbm5ld1RyZWUuaW5zZXJ0KDU1KTtcbm5ld1RyZWUuaW5zZXJ0KDU2KTtcbm5ld1RyZWUuaW5zZXJ0KDU3KTtcbm5ld1RyZWUuaW5zZXJ0KDU4KTtcbnByZXR0eVByaW50KG5ld1RyZWUucm9vdCk7XG4vLyBjb25zb2xlLmxvZyhuZXdUcmVlLmZpbmRMZWZ0TGVhZihuZXdUcmVlLnJvb3QpKTtcbi8vIGNvbnNvbGUubG9nKG5ld1RyZWUuZmluZCg2NykpO1xuLy8gY29uc29sZS5sb2cobmV3VHJlZS50cmVlVG9BcnJheShuZXdUcmVlLnJvb3QpKTtcblxubmV3VHJlZS5kZWxldGVJdGVtKDQpO1xucHJldHR5UHJpbnQobmV3VHJlZS5yb290KTtcbi8vICBwcmV0dHlQcmludChuZXdUcmVlLmZpbmQoOSkpO1xuXG5mdW5jdGlvbiBwcmludE5vZGUobm9kZSkge1xuICBjb25zb2xlLmxvZyhub2RlLmRhdGEpO1xufVxuLy8gbmV3VHJlZS5sZXZlbE9yZGVyKHByaW50Tm9kZSk7XG4vL25ld1RyZWUucHJlT3JkZXIocHJpbnROb2RlKTtcbi8vbmV3VHJlZS5pbk9yZGVyKHByaW50Tm9kZSk7XG4vL25ld1RyZWUucG9zdE9yZGVyKHByaW50Tm9kZSk7XG4vLyBsZXQgbXlOb2RlID0gbmV3VHJlZS5maW5kKDYzNDUpO1xuLy8gcHJldHR5UHJpbnQobXlOb2RlKTtcbi8vIGNvbnNvbGUubG9nKGBoZWlnaHQgJHtuZXdUcmVlLmhlaWdodChteU5vZGUpfWApO1xuLy8gY29uc29sZS5sb2coYGRlcHRoICR7bmV3VHJlZS5kZXB0aChteU5vZGUpfWApO1xuY29uc29sZS5sb2coYGlzIGJhbGFuY2VkICR7bmV3VHJlZS5pc0JhbGFuY2VkKCl9YCk7XG5uZXdUcmVlLnJlYmFsYW5jZSgpO1xucHJldHR5UHJpbnQobmV3VHJlZS5yb290KTtcbmNvbnNvbGUubG9nKGBpcyBiYWxhbmNlZCAke25ld1RyZWUuaXNCYWxhbmNlZCgpfWApO1xuIl0sIm5hbWVzIjpbIm1lcmdlU29ydCIsImFyciIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJkaXZpZGUiLCJNYXRoIiwiZmxvb3IiLCJyaWdodCIsInNsaWNlIiwibGVmdCIsInNwbGljZSIsIm1lcmdlZCIsImwiLCJyIiwiaSIsImNvbmNhdCIsImxlZnRvdmVyIiwiQXJyYXkiLCJpc0FycmF5IiwiTm9kZSIsImRhdGEiLCJwcmV0dHlQcmludCIsIm5vZGUiLCJwcmVmaXgiLCJpc0xlZnQiLCJuZXdUcmVlIiwiYnVpbGRUcmVlIiwic3RhcnQiLCJlbmQiLCJtaWQiLCJwYXJzZUludCIsIm5ld05vZGUiLCJub0R1cGVzQXJyYXkiLCJhcnJheXJheSIsInJlbW92ZUR1cGVzIiwicm9vdCIsInJlYmFsYW5jZUFycmF5IiwiaW5zZXJ0IiwidmFsdWUiLCJjaGVja05vZGUiLCJmaW5kTGVmdExlYWYiLCJzdGFydGluZ05vZGUiLCJmaW5kIiwidHJlZVRvQXJyYXkiLCJuZXdBcnJheSIsImRlbGV0ZUl0ZW0iLCJjdXJyZW50Tm9kZSIsInByZXZOb2RlIiwiZGlyZWN0aW9uIiwiZm91bmRMZWFmIiwibGV2ZWxPcmRlciIsImNhbGxiYWNrIiwicXVldWUiLCJFcnJvciIsInB1c2giLCJzaGlmdCIsInByZU9yZGVyIiwiaW5PcmRlciIsInN0YWNrIiwicG9wIiwicG9zdE9yZGVyIiwiaGVpZ2h0IiwiY291bnQiLCJtYXhjb3VudCIsImRlcHRoIiwicG9pbnRlciIsImFkZFRvQXJyYXkiLCJpc0JhbGFuY2VkIiwiYWJzIiwicmViYWxhbmNlIiwibmV3Um9vdCIsIlRyZWUiXSwic291cmNlUm9vdCI6IiJ9